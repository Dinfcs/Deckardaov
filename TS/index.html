<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyborg Project Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #0b0e14;
            --bg-card: #151921;
            --bg-input: #1c212c;
            --border-color: #2d333b;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --text-main: #e6edf3;
            --text-dim: #848d97;
            --success: #238636;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        .glass-card {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .top-section { margin-bottom: 24px; }

        .search-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 12px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid var(--border-color);
        }

        .table-wrapper {
            max-height: 280px;
            overflow-y: auto;
            scrollbar-width: thin;
        }

        table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }

        th {
            background-color: #1c212c;
            color: var(--text-dim);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            padding: 12px 16px;
            text-align: left;
            position: sticky; top: 0; z-index: 10;
        }

        td {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
            cursor: pointer;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        tr:hover td { background-color: rgba(99, 102, 241, 0.05); color: white; }

        tr.selected-row td {
            background-color: rgba(99, 102, 241, 0.2) !important;
            border-bottom: 1px solid var(--accent);
        }

        .workbench {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 24px;
            align-items: start;
        }

        .form-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .input-group { padding: 12px 16px; }

        label {
            display: block;
            color: var(--text-dim);
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .styled-input {
            width: 100%;
            background-color: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px 12px;
            color: white;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .styled-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .styled-input[readonly] { opacity: 0.6; cursor: not-allowed; }

        .check-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .check-container:hover { background: rgba(255, 255, 255, 0.03); }

        .check-container input { width: 16px; height: 16px; accent-color: var(--accent); }

        .check-container span { font-size: 0.85rem; color: var(--text-main); }

        .output-wrapper {
            position: relative;
            height: 100%;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .output-pre {
            flex: 1;
            background-color: #0d1117;
            padding: 20px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #d1d5db;
            border-radius: 0 0 12px 12px;
            border: 1px solid var(--border-color);
            border-top: none;
            white-space: pre-wrap;
            overflow-y: auto;
        }

        .copy-banner {
            background-color: #1c212c;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filename-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #0b0e14;
            padding: 4px 12px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            margin-left: 15px;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover { background-color: var(--accent-hover); transform: translateY(-1px); }

        .btn-s3 {
            background-color: #ff9900;
            color: #000;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .logo-preview-box {
            position: absolute;
            right: 12px;
            top: 30px;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            background: var(--bg-main);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
        }

        #logoPreview { max-width: 100%; max-height: 100%; display: none; }

        #notificacion {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
    </style>
</head>
<body>

    <div class="top-section glass-card">
        <div class="search-grid">
            <input type="text" id="buscarSplit" class="styled-input" placeholder="UT - City of Cottonwood Heights" oninput="autoSplitSearch()">
            <input type="text" id="buscar1" class="styled-input" placeholder="Filtro 1" oninput="filtrarTabla()">
            <input type="text" id="buscar2" class="styled-input" placeholder="Filtro 2" oninput="filtrarTabla()">
            <button class="btn-s3" onclick="window.open('https://webapp-8ba8c4de11154ee89.transfer-webapp.us-west-2.on.aws/', '_blank')">S3 BUCKET</button>
        </div>
        
        <div class="table-wrapper">
            <div id="loader" style="display:none; text-align:center; padding:20px; color: var(--text-dim);">Cargando datos...</div>
            <div id="tabla-container"></div>
        </div>
        
        <div id="paginacion" class="p-3 flex justify-center gap-4 items-center bg-black bg-opacity-20 border-t border-gray-800"></div>
    </div>

    <div class="workbench">
        <div class="glass-card">
            <div class="form-header">
                <span>CONFIGURATOR</span>
                <span class="text-xs text-indigo-400">CYBORG ENGINE</span>
            </div>

            <div class="input-group relative">
                <label>LOGO LINK</label>
                <input type="text" id="logoUrl" class="styled-input" oninput="generateConfig()" placeholder="URL automática...">
                <div class="logo-preview-box" onclick="expandLogo()">
                    <img id="logoPreview" src="" alt="">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2">
                <div class="input-group">
                    <label>PLACE KEY</label>
                    <input type="text" id="placeKey" class="styled-input" oninput="autoFillFields(); generateConfig()">
                </div>
                <div class="input-group">
                    <label>NS CODE</label>
                    <input type="text" id="placens" class="styled-input" oninput="generateConfig()">
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2 px-4 py-2">
                <div><label>STATE</label><input type="text" id="state" class="styled-input" readonly></div>
                <div><label>COUNTY</label><input type="text" id="county" class="styled-input" readonly></div>
                <div><label>CITY</label><input type="text" id="city" class="styled-input" readonly></div>
            </div>

            <div class="input-group">
                <label>RENTAL DAYS</label>
                <input type="number" id="days" class="styled-input" value="30" oninput="generateConfig()">
            </div>

            <div class="py-2">
                <label class="px-4 pb-2">PREFERENCES</label>
                <label class="check-container"><input type="checkbox" id="enableNotes" checked onchange="generateConfig()"><span>Enable Notes</span></label>
                <label class="check-container"><input type="checkbox" id="showSuggestions" checked onchange="generateConfig()"><span>Suggestions</span></label>
                <label class="check-container"><input type="checkbox" id="pdf" checked onchange="generateConfig()"><span>PDF Scraping</span></label>
                <label class="check-container"><input type="checkbox" id="warmCache" checked onchange="generateConfig()"><span>Warm Cache</span></label>
                <label class="check-container"><input type="checkbox" id="includeCities" onchange="generateConfig()"><span>Include Cities</span></label>
                <label class="check-container"><input type="checkbox" id="enablePropertyDetails" onchange="generateConfig()"><span>Special Provider (HdL...)</span></label>
            </div>
        </div>

        <div class="output-wrapper">
            <div class="copy-banner">
                <div class="flex items-center">
                    <div class="flex gap-1.5 mr-2">
                        <span class="w-3 h-3 rounded-full bg-red-500/20 border border-red-500/50"></span>
                        <span class="w-3 h-3 rounded-full bg-yellow-500/20 border border-yellow-500/50"></span>
                        <span class="w-3 h-3 rounded-full bg-green-500/20 border border-green-500/50"></span>
                    </div>
                    <!-- CONTENEDOR DE NOMBRE DINÁMICO -->
                    <div class="filename-container">
                        <span id="ymlFileName" class="text-xs font-mono text-indigo-400">generated_config.yml</span>
                        <button onclick="copiarNombreArchivo()" class="text-gray-500 hover:text-white transition-colors" title="Copiar nombre del archivo">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
                            </svg>
                        </button>
                    </div>
                </div>
                <button class="btn-primary" onclick="copiarYAML()">COPY FULL YAML</button>
            </div>
            <pre id="output" class="output-pre"></pre>
        </div>
    </div>

    <div id="notificacion">Copiado</div>

    <script>
        const S3_BASE_URL = "https://rentalscape-assets-prod-usw2.s3.us-west-2.amazonaws.com/customer_logos/";

        function capitalize(str) { return str.replace(/_/g, ' ').replace(/\b\w/g, char => char.toUpperCase()); }

        function copiarTexto(texto) {
            if (!texto) return;
            navigator.clipboard.writeText(texto).then(() => mostrarNotificacion("Texto copiado"));
        }

        // --- NUEVA FUNCIÓN PARA COPIAR SOLO EL NOMBRE DEL ARCHIVO ---
        function copiarNombreArchivo() {
            const fileName = document.getElementById("ymlFileName").textContent;
            navigator.clipboard.writeText(fileName).then(() => {
                mostrarNotificacion("Nombre de archivo copiado");
            });
        }

        function autoFillFields() {
            const placeKey = document.getElementById("placeKey").value.trim().toLowerCase();
            const parts = placeKey.split("-");
            if (parts.length >= 2) {
                document.getElementById("state").value = parts[0].toUpperCase();
                document.getElementById("county").value = capitalize(parts[1]);
                document.getElementById("city").value = parts.length >= 3 ? capitalize(parts.slice(2).join("-").replace("city of ", "")) : "";
            }
        }

        function generateConfig() {
            const placeKeyInput = document.getElementById("placeKey").value.trim().toLowerCase();
            const state = document.getElementById("state").value.trim();
            const logoUrl = document.getElementById("logoUrl").value.trim();
            const nsInput = document.getElementById("placens");
            const nsField = nsInput.dataset.currentId || "placens";
            const days = document.getElementById("days").value || 30;
            const nights = days - 1;

            if (!placeKeyInput) { 
                document.getElementById("output").textContent = "# Selecciona un lugar de la tabla..."; 
                document.getElementById("ymlFileName").textContent = "generated_config.yml";
                return; 
            }

            let placeName = "";
            let fileName = "generated_config.yml";

            if (filaSeleccionada !== null) {
                const fila = datosFiltrados[filaSeleccionada];
                let rawName = fila['string_name'] || fila['String_name'] || fila['string name'] || "";
                
                // LÓGICA DE NOMBRE DE ARCHIVO
                // Tomamos el nombre, quitamos la coma si tiene (ej: "Simsbury, CT" -> "Simsbury")
                let baseName = rawName.split(',')[0].trim();
                fileName = baseName.toLowerCase().replace(/\s+/g, '_') + ".yml";
                document.getElementById("ymlFileName").textContent = fileName;

                placeName = rawName.includes(',') ? rawName : `${rawName}, ${state}`;
            }

            let yaml = `logo: ${logoUrl}\nmodules:\n  notes:\n    mode: ${document.getElementById("enableNotes").checked ? "enabled" : "disabled"}\n    read:\n      - admin\n      - ${placeKeyInput}\n    rw:\n      - ${placeKeyInput}\n  rentalscape:\n`;
            if (document.getElementById("enablePropertyDetails").checked) {
                yaml += `    propertyDetails:\n      tabs:\n        activity:\n          enabled: true\n        history:\n          enabled: true\n        license:\n          enabled: false\n`;
            }
            if (document.getElementById("includeCities").checked) yaml += `    includeCities: true\n`;
            yaml += `    licenseEditMode: rs_on_page\n    emailCcDeckard: Rentalscape Support <rentalscape@deckard.com>\n    propertySummaryMode: IDENTIFIED\n    production:\n      warm: ${document.getElementById("warmCache").checked}\n    rentalPeriod:\n      days: ${days}\n    rentalTypes:\n      current: Current STR (${nights} nights or less)\n      hotel: Hotel/Timeshare\n      ltr: Long Term Rental\n      other: Other Rental\n      previous: Previously an STR\n      unavailable: Unavailable\n`;
            if (document.getElementById("showSuggestions").checked) yaml += `    showSuggestions: true\n`;
            yaml += `name: ${placeName}\npdf: ${document.getElementById("pdf").checked}\n${nsField}: '${nsInput.value.trim()}'`;

            const cleanedYaml = yaml.split('\n').map(l => l.trimEnd()).join('\n').trimEnd() + "\n"; 
            document.getElementById("output").textContent = cleanedYaml;
            
            const preview = document.getElementById("logoPreview");
            if (logoUrl) { preview.src = logoUrl; preview.style.display = "block"; }
            else { preview.style.display = "none"; }
        }

        function seleccionarFila(index) {
            filaSeleccionada = index;
            const fila = datosFiltrados[index];
            if (!fila) return;

            const rawPlaceNameFromTable = fila['place_name'] || fila['Place_name'] || fila['Place Name'] || "";
            document.getElementById("logoUrl").value = S3_BASE_URL + rawPlaceNameFromTable + ".png";
            document.getElementById("placeKey").value = rawPlaceNameFromTable;
            autoFillFields();

            const nsInput = document.getElementById("placens");
            const type = (fila['place'] || "").toLowerCase();
            if (type === 'county') nsInput.dataset.currentId = "countyns";
            else if (type === 'cousub') nsInput.dataset.currentId = "cousubns";
            else nsInput.dataset.currentId = "placens";
            
            nsInput.value = fila['code'] || fila['Code'] || fila['place_code'] || "";
            actualizarTabla();
            generateConfig();
        }

        let datosCompletos = [], datosFiltrados = [], encabezados = [], filaSeleccionada = null;
        let paginaActual = 1, filasPorPagina = 8;

        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("loader").style.display = "block";
            fetch("https://dinfcs.github.io/Deckardaov/TS/datos_exportados.json")
                .then(r => r.json()).then(d => {
                    document.getElementById("loader").style.display = "none";
                    encabezados = d[0];
                    datosCompletos = d.slice(1).map(f => {
                        let o = {}; encabezados.forEach((c, i) => o[c] = f[i] || ""); return o;
                    });
                    datosFiltrados = [...datosCompletos];
                    actualizarTabla();
                });
        });

        function filtrarTabla() {
            const f1 = document.getElementById("buscar1").value.toLowerCase();
            const f2 = document.getElementById("buscar2").value.toLowerCase();
            datosFiltrados = datosCompletos.filter(f => 
                (f1 === "" || Object.values(f).some(v => v.toString().toLowerCase().includes(f1))) &&
                (f2 === "" || Object.values(f).some(v => v.toString().toLowerCase().includes(f2)))
            );
            if (datosFiltrados.length === 1) seleccionarFila(0);
            else filaSeleccionada = null;
            paginaActual = 1;
            actualizarTabla();
        }

        function actualizarTabla() {
            let inicio = (paginaActual - 1) * filasPorPagina;
            let paged = datosFiltrados.slice(inicio, inicio + filasPorPagina);
            let h = "<table><thead><tr><th>SEL</th>" + encabezados.map(e => `<th>${e}</th>`).join("") + "</tr></thead><tbody>";
            paged.forEach((f, i) => {
                const isSel = filaSeleccionada !== null && datosFiltrados[filaSeleccionada] === f;
                h += `<tr class="${isSel ? 'selected-row' : ''}">
                    <td class="text-center"><input type="radio" name="sel" ${isSel ? 'checked' : ''} onclick="seleccionarFila(${inicio + i})"></td>`;
                encabezados.forEach(e => {
                    let valorLimpio = f[e].toString().replace(/'/g, "\\'");
                    h += `<td onclick="copiarTexto('${valorLimpio}')">${f[e]}</td>`;
                });
                h += `</tr>`;
            });
            document.getElementById("tabla-container").innerHTML = h + "</tbody></table>";
            actualizarPaginacion();
        }

        function actualizarPaginacion() {
            let total = Math.ceil(datosFiltrados.length / filasPorPagina);
            document.getElementById("paginacion").innerHTML = total > 1 ? 
                `<button class="btn-primary" onclick="cambiarPagina(-1)">PREV</button> <span class="text-xs font-mono">PAGE ${paginaActual} / ${total}</span> <button class="btn-primary" onclick="cambiarPagina(1)">NEXT</button>` : "";
        }

        function cambiarPagina(d) { paginaActual += d; actualizarTabla(); }

        function autoSplitSearch() {
            const v = document.getElementById("buscarSplit").value;
            if (v.includes("-")) {
                const [p1, p2] = v.split("-").map(s => s.trim());
                document.getElementById("buscar1").value = p1;
                document.getElementById("buscar2").value = p2;
                filtrarTabla();
            }
        }

        function copiarYAML() {
            navigator.clipboard.writeText(document.getElementById("output").textContent);
            mostrarNotificacion("¡YAML Copiado!");
        }

        function mostrarNotificacion(mensaje) {
            const n = document.getElementById("notificacion");
            n.textContent = mensaje; n.style.display = "block"; 
            setTimeout(() => n.style.display = "none", 2000);
        }

        function expandLogo() {
            const src = document.getElementById("logoPreview").src;
            if (!src) return;
            const div = document.createElement("div");
            div.style = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:flex;justify-content:center;align-items:center;z-index:9999;cursor:zoom-out;";
            div.innerHTML = `<img src="${src}" style="max-width:80%; max-height:80%; border: 2px solid white;">`;
            div.onclick = () => div.remove();
            document.body.appendChild(div);
        }
    </script>
</body>
</html>
